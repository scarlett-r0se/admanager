<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="Small Website for our senior project." content="">
    <meta name="Scarlett & Jose" content="Senior Project">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>Transcend Inc. Account Page</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" >

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>
    <!-- Custom styles for this template -->
    <link href="css/cover.css" rel="stylesheet">
</head>

<body class="text-center">
    <div id="logoutmodal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Are you sure you want to log out?</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Logging out will take you back to the home page</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" id="modallogout" >Logout</button>
              <button type="button" class="btn btn-dark" id="modalclose" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>

    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="masthead mb-auto">
            <div class="inner">
                <img class="masthead-brand" src="image/t.png" alt="" width="35" height="35">
                <div class="masthead-brand">&emsp;</div>
                <h3 class="masthead-brand">Transcend Inc.</h3>
                <nav class="nav nav-masthead justify-content-center">
                    <a class="nav-link active" href="index.html">Home</a>
                </nav>
            </div>
        </header>

        <main role="main" class="inner cover">
            <h1 class="cover-heading display-1" id="greeter"></h1>
            <p class="lead">Welcome to your account page.</p>
            <div class="text-left">
                <a href="createaccount.html" class="btn btn-secondary">Create Account</a><br><br>
                <button id='logout' type="button" class="btn btn-danger">Logout</button><br>
            </div>
        </main>
        <footer class="mastfoot mt-auto">
            <p class="mt-5 mb-3 text-muted">Transcend Inc. &copy; 2020-2020</p>
        </footer>

    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            console.log("THE PAGE HAS LOADED AND JS AND JQUERY PROBABLY WORK IF YOUR'RE READING THIS")
            sendRequest(`http://10.0.2.6:3000/whoisloggedin`,(output)=>
            {
                console.log(output);
                const data = JSON.parse(output);
                let email = JSON.stringify(data.result.email)
                email = email.replace(/"/gm,"");
                email = email.replace(/\@.*$/gm,"");
                $('#greeter').empty();
                $('#greeter').append(`Hello ${email}`);
                console.log(data.result.email);

            });


        $('#register').click(function()

        {
            $('#status').empty();
            $('#status').removeClass();

            console.log("Account Register has been called");
            let fname = $('#fname').val().trim();
            let lname = $('#lname').val().trim();
            let pass = $('#pass').val().trim();
            let cpass = $('#cpass').val().trim();
            let group = $('#group').val().trim();
            let dataCheck = false;
            status = '';
            if(fname==''||lname=='')
                    status = 'Please Enter a Valid First and Last name. ';
            else if(pass==''&&cpass=='')
            {
                status = status + 'Passwords cannot be left blank';
            }
            else if(cpass!=pass)
            {
                status = status + 'Passwords Must Match';
            }
            else if(group=='Default')
            {
                status = status + 'You must select a defualt group';

            }
            else{
                dataCheck = true;
                profile = createUserJson(fname,lname,pass,group);
                console.log(profile);
            }





           console.log(`You have entered ${fname} and ${lname} and ${pass} and ${group}`);
            //`http://localhost/newuser=?Fname=${fname}&Lname=${lname}&Password=${pass}`


            if(dataCheck)
            {
            sendRequest(`http://10.0.2.6:3000/newuser?Fname=${fname}&Lname=${lname}&Password=${pass}&Group=${profile.Group}&Username=${profile.Username}`,(output)=>{
               console.log(output);
               $('#status').empty();
               $('#status').addClass("suc");
               $('#status').append(`${output}`);
               alert(`Username is ${profile.Username}`)


           });
            }
            else
            {
                $('#status').addClass("err");
                $('#status').append(status);
            }

        });

        $('#logout').click(function(){
            $('#logoutmodal').show();
        });

        $('#modalclose').click(function(){
            $('#logoutmodal').hide();
        })

        $('#modallogout').click(function(){
            sendRequest(`http://10.0.2.6:3000/logout`,(output)=>{

              let data = JSON.parse(output);
                if(data.error == "Nobody is logged in.");
                {
                    window.location.replace("http://10.0.2.6:3000/");
                }
            });
        })
        function sendRequest(theUrl, callback)
        {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    callback(xmlHttp.responseText);
            }
            xmlHttp.open("GET", theUrl, true); // true for asynchronous
            xmlHttp.send(null);
        }


        //===========================================
        function getRandomInt(max,min) {
            return Math.floor(Math.random() * max) + min;
        }

        function createUserJson(firstname,lastname,password,group)
        {
            userProfile = {
            "Username" : firstname[0].toUpperCase()+lastname[0].toUpperCase()+getRandomInt(8999,1000),
            "FName": firstname,
            "LName" : lastname,
            "Password" : password,
            'Group': group,

            }
        return userProfile;
        }

    });
    </script>


</body>

</html>
